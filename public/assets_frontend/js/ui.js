var ui={construct:function(){this.home.catalog.set_sizes(),this.home.catalog.show(),$("#titlebar_buttons div").click(function(){hostApp.sendWinAction($(this).attr("id"))}),$(".js-button-category").click(function(){$("#header .activated").removeClass("activated"),$('.js-button-category[data-section="'+$(this).data("section")+'"]').addClass("activated"),$("#search_input").val(""),$("#select_sortby option")[0].selected=!0,ui.home.catalog.show()});for(var e=0;e<resource.genres.length;e++)$('<div class="genre" data-genre="'+resource.genres[e]+'" data-in-trans="'+resource.genres[e]+'">'+locale.translate(resource.genres[e])+"</div>").appendTo("#genres_box");$("#genres_box .genre:nth-child(1)").addClass("activated"),$("#toolbar_genres").hover(function(){setTimeout("ui.home.genres_box.on=1",1),ui.home.genres_box.show()},function(){ui.home.genres_box.on=0,ui.home.genres_box.hide()}),$("#genres_box .genre").click(function(){$("#genres_box .genre.activated").removeClass("activated"),$(this).addClass("activated"),$("#search_input").val(""),ui.home.catalog.show()}),$("#search_input").keydown(function(e){var o;13==e.which&&$(this).val()?$("#autocomplete .khover").length?$("#autocomplete .khover").click():ui.home.catalog.show():40==e.which?(o=$("#autocomplete .khover"),$("#autocomplete .khover").removeClass("khover"),(o.length?o.next():$("#autocomplete div").first()).addClass("khover")):38==e.which&&(o=$("#autocomplete .khover"),$("#autocomplete .khover").removeClass("khover"),(o.length?o.prev():$("#autocomplete div").last()).addClass("khover"))}).focus(function(){$("#search_cont").addClass("activated")}).blur(function(){""==$(this).val()&&$("#search_cont").removeClass("activated"),setTimeout(function(){$("#autocomplete").removeClass("visible")},300)}).keyup(function(e){return 27==e.which?($("#search_input").blur(),void $("#search_cont.activated").removeClass("activated")):void(8!=e.which&&46!=e.which||""!=$(this).val()?(40<e.which||8==e.which)&&2<$(this).val().length&&"movies"==$("#toolbar .btn.activated").data("section")&&(window.autocompleteXhr&&window.autocompleteXhr.abort&&window.autocompleteXhr.abort(),$("#autocomplete").html("").removeClass("visible"),window.autocompleteXhr=$.get(app.config.api_keys.tmdb_url+"search/multi?api_key="+app.config.api_keys.tmdb+"&query="+encodeURIComponent($(this).val()),function(e){if(e.results&&e.results.length){$("#autocomplete").html("").addClass("visible");var o,t={};for(o in e.results.forEach(function(e){"tv"==e.media_type&&e.name,t[e.title]=e.id}),t)$("#autocomplete").append("<div onmouseover=\"$(this).addClass('khover')\" onmouseout=\"$(this).removeClass('khover')\" onclick=\"$('#search_input').val('"+o.replace(/'/g,"")+"');$('#search_input').data('imdb','"+t[o]+"');ui.home.catalog.show()\">"+o+"</div>")}},"json")):ui.home.catalog.show())}),$("#search_cont .icon").click(function(){""!=$("#search_input").val()&&ui.home.catalog.show()}),$("#right_bar .icon.search").click(function(){ui.home.catalog.show()}),$("body").mousedown(function(e){ui.mouseDownClientX=e.clientX}).mouseup(function(e){"favs"!=ui.home.catalog.section&&240<Math.abs(e.clientX-ui.mouseDownClientX)&&Mousetrap.trigger("shift")}).mousemove(function(e){e.clientX<25&&60<e.clientY&&"mainWindow"==app.state&&!$("body.sidemenu_open").length&&Mousetrap.trigger("shift")}),$("#side_menu").mouseleave(function(){Mousetrap.trigger("shift")}),$("#mode_box span").click(function(){$("#mode_box span.activated").removeClass("activated"),$(this).addClass("activated"),app.config.fetcher.mode=$(this).html().toLowerCase()}),$("#history_panel .caption").click(function(){"-105px"==$("#history_panel")[0].style.bottom?$("#history_panel").css({bottom:0}):$("#history_panel").css({bottom:"-105px"})}),ui.loading_wrapper.init(),$("#mode_box span").click(function(){app.config.fetcher.mode=$(this).data("mode"),$("#mode_box .activated").removeClass("activated"),$(this).addClass("activated"),ui.home.catalog.show()}),app.config.hostApp.isVPN||$(".vpn").remove()},home:{catalog:{items:{},set_sizes:function(e){e&&app.config.set({ui:{coverScale:e/100+1}});e=$("body").width();ui.home.catalog.numItemsInRow=Math.floor(e/(app.config.ui.coverWidth*app.config.ui.coverScale)),ui.home.catalog.item_width=e/ui.home.catalog.numItemsInRow-1,ui.home.catalog.item_height=ui.home.catalog.item_width/.66,$("#movies_catalog .movie").css({width:ui.home.catalog.item_width+"px",height:ui.home.catalog.item_height+"px"}),$("#movies_catalog .movie .title").css("font-size",app.config.ui.coverTiteSize*app.config.ui.coverScale),$("#movies_catalog .movie .year").css("font-size",app.config.ui.coverYearSize*app.config.ui.coverScale),$("#movies_catalog .movie .tools").css("font-size",app.config.ui.coverToolsSize*app.config.ui.coverScale),$("#movies_catalog .movie .stars").css("font-size",app.config.ui.coverStarsSize*app.config.ui.coverScale),$("#size_setter").val(Math.round(100*(app.config.ui.coverScale-1))),ui.home.catalog.scroller&&ui.home.catalog.scroller.refresh()},show:function(i){i?ui.home.catalog.page=i:(ui.home.catalog.items={},ui.home.catalog.page=1),ui.sliders.close_all(),app.state="mainWindow",$("#history_panel").hide();var a=$("#search_input").data("imdb")||$("#search_input").val(),e=($(".genre.active"),!a&&$("#genres_box .genre.activated").data("genre")||"all"),s=$("#toolbar .btn.activated").data("section");$("#search_input").data("imdb",""),s||($("#header .activated").removeClass("activated"),$("#toolbar .btn:nth(0)").addClass("activated"),s="movies"),ui.home.catalog.section=s,fetcher.fetch.items(s,e,a,function(e,o){if(!e&&o instanceof Array){i||(ui.home.catalog.clear(),$('<div style="width:100%;height:65px;float:left"></div>').appendTo("#catalog_scroller"));for(var t=0;t<o.length;t++)ui.home.catalog.appendItem(o[t],s,t);$("#movies_catalog").bind("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight-400&&ui.home.catalog.show(++ui.home.catalog.page)}),ui.home.catalog.showUnloadedItems(ui.home.catalog.page),ui.home.catalog.scroller?ui.home.catalog.scroller.refresh():(ui.home.catalog.scroller=new IScroll("#movies_catalog",{mouseWheel:!0,mouseWheelSpeed:30,scrollbars:!0,hScrollbar:!1,vScrollbar:!0,click:!0,fadeScrollbars:!0,interactiveScrollbars:!0,resizeScrollbars:!0,shrinkScrollbars:"scale"}),ui.home.catalog.scroller.on("scrollEnd",function(){"favs"!=ui.home.catalog.section&&Math.abs(this.maxScrollY)-Math.abs(this.y)<600&&ui.home.catalog.page&&ui.home.catalog.show(++ui.home.catalog.page)})),i||ui.home.catalog.scroller.scrollTo(0,a?0:-65)}else ui.home.catalog.noResult(),logger.log(e)})},appendItem:function(e,o,t){e.infavs=app.favs.list[e.imdb]?"infavs":"";var i={id:e.imdb,title:e.title,year:e.year,runtime:e.runtime,stars:e.stars,infavs:e.infavs,poster_img:'<img onError="this.onerror=null;this.src=\'https://popcorntimeonline.xyz/css/images/poster.png\';" src="'+e.poster_small+'" onload="setTimeout(function(){$(\'#movie-'+e.imdb+"').css({opacity: 1,transform: 'scale(1, 1)'})},1);$('#movie-"+e.imdb+"').removeClass('unloaded')\">",titleFontSize:app.config.ui.coverTiteSize*app.config.ui.coverScale,yearFontSize:app.config.ui.coverYearSize*app.config.ui.coverScale,toolsFontSize:app.config.ui.coverToolsSize*app.config.ui.coverScale,starsFontSize:app.config.ui.coverStarsSize*app.config.ui.coverScale},i=utils.tokenizer(i,document.getElementById("movie_cover_html").innerHTML);ui.home.catalog.items[e.imdb.toString()]||(ui.home.catalog.items[e.imdb.toString()]=e),$('<div data-section="'+o+'" data-movie_id="'+e.imdb+'"  id="movie-'+e.imdb+'" style="width:'+ui.home.catalog.item_width+"px;height:"+ui.home.catalog.item_height+"px;transition-delay: 0s, "+t/23+'s;" class="movie unloaded p'+ui.home.catalog.page+'">'+i+"</div>").appendTo("#catalog_scroller").click(function(e){-1==$(e.target).attr("class").indexOf("-btn")&&ui[$(this).data("section")].show($(this).data("movie_id"))}).mouseenter(function(){$("#movies_catalog .movie.khover").removeClass("khover"),$(this).addClass("khover")})},showUnloadedItems:function(e){setTimeout(function(){$("#movies_catalog .unloaded.p"+e).css({opacity:1,transform:"scale(1, 1)"}).removeClass("unloaded")},5e3)},clear:function(){$("#catalog_scroller").html(""),$("#catalog_scroller").sortable({disabled:!0})},noResult:function(){1==ui.home.catalog.page&&$("#catalog_scroller").html('<div class="noResults">No results found...</div>');try{ui.home.catalog.scroller.scrollToElement($("#catalog_scroller .noResults")[0],null,null,!0)}catch(e){}fetcher.scrappers.tv_idx=0,fetcher.scrappers.movies_idx=0}}},about_page:{show:function(){var e,o;ui.sliders.slider.about?ui.sliders.slider.about.hide():(app.state="aboutPage",o=((e=location.href.match(/version=([0-9\.]+)/))&&e[1]||"")+(location.href.match(/version=([0-9\.]+)a/)?" Alpha":""),e=utils.tokenizer({version:o},$("#about_page_html").html()),(o=new ui.slider("about","fadein")).el.append(e),o.destruct=function(){app.state="mainWindow"},o.show())}},sliders:{slider:{},close_all:function(){for(var e in ui.sliders.slider)ui.sliders.slider[e].hide()}},slider:function(e,o){if(ui.sliders[e])return ui.sliders[e];var t,i=(t={fadein:[{top:"0"},{top:"0"}],bottom:[{top:"0"},{top:"200%"}],right:[{left:"0"},{left:"200%"}],left:[{left:"0"},{left:"-200%"}]},o&&t[o]?[t[o],o]:[t.fadein,"fadein"]),a=$('<div id="slider_'+e+'" class="slider '+i[1]+'" data-id="'+e+'"><div class="close" onclick="ui.sliders.slider[\''+e+"'].hide()\"></div></div>");return a.appendTo("body"),ui.sliders.slider[e]={el:a,id:e,show:function(){var e=i[0][0];e.opacity=1,setTimeout(function(){a.css(e)},1)},hide:function(){i[0][1].opacity=0,a.fadeOut(function(){$(this).remove()}),utils.setMetas({title:utils.titles.common,url:"/"}),"function"==typeof this.destruct&&this.destruct(),delete ui.sliders.slider[e]}},ui.sliders.slider[e]},torrent_report:{show:function(e){$(e).parents(".torrent_info").fadeOut("fast",function(){var e=$(this).next(".torrent_report");e.fadeIn("fast"),setTimeout(function(){ui.torrent_report.hide(e)},5e3)})},hide:function(e){e.length&&e.fadeOut("fast",function(){$(this).prev(".torrent_info").fadeIn("fast")})},send:function(e,o){e=$(e).parents(".torrent_option"),e.data("id");e.fadeOut("fast",function(){utils.msgbox('<span style="font-size:16px;">Hasta la vista, Torrent</span>'),$(this).remove(),$(".slider .torrents .torrent_option:first-child").addClass("activated")})}},trailer:{show:function(e){var o=new ui.slider("trailer","fadein");o.el.append('<div style="width:100%;height:100%;box-sizing:border-box;overflow:hidden;"><iframe src="'+e+'" style="width:100%; height:100%;" frameborder="0" scrolling="0"></iframe></div>'),o.show()},close:function(){ui.sliders.slider.trailer.hide()}},streaming:{show:function(e){var o=new ui.slider("streaming","fadein");o.el.append('<div style="width:100%; height:100%; box-sizing:border-box; overflow:hidden;"><iframe src="'+e+'" style="width:100%; height:100%;" frameborder="0" scrolling="0" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>'),o.show()},close:function(){ui.sliders.slider.streaming.hide()}},events:{watch_btn_click:function(e){ui.loading_wrapper.show();var o=document.section.chosen[0].checked?"movie_slider":"tvshow_slider",t=("0"!=$("#"+o+" .torrents_list").val().toString()?$("#"+o+" .torrents_list").val():$("#"+o+" .torrents_list option")[1].value).split(","),o="0"!=$("#"+o+" .subtitles_list").val().toString()?$("#"+o+" .subtitles_list").val():null;app.torrent.get(t[0],t[1],o)},window_resize:function(){ui.home.catalog.set_sizes()}},disableAnimations:function(e){$("body")[e?"addClass":"removeClass"]("disable_animations")},hideGlare:function(e){console.log(e.value),app.config.set({hostApp:{hideGlare:e.checked?1:0}}),$("body")[e.checked?"addClass":"removeClass"]("hideGlare")}};